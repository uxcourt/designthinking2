<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">


	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>

	<script src="scripts/connect.js"></script>
	<link type="text/css" rel="stylesheet" href="css/StyleSheet1.css" />


	<script type="text/javascript">
var count=1800;

var counter=setInterval(timer, 1000); //1000 will  run it every 1 second

function timer(){
  count=count-1;
  if (count <= 0)
  {
     clearInterval(counter);
     //counter ended, do something here
     return;
  }
	var minutes = Math.floor(count / 60);
	var seconds =  Math.floor(count-minutes*60);
	var fseconds = seconds.toLocaleString('en-US', {minimumIntegerDigits: 2, useGrouping:false});

 	document.getElementById("timer").innerHTML=minutes +":"+fseconds;
}

var fCount=location.search.substr(location.search.indexOf("=")+1)

function placeFriends(){
	for (i=0;i<fCount;i++){
	$("#map").append('<img src="images/icons/friend-map.png" alt="friend" height="15px" id="f'+ i +'"/>');
	}
}

function moveMeeting(e){
	//alert('hi');
	// determine event object
	if (!e) {
		var e = window.event;
	}
    if(e.preventDefault) e.preventDefault();

	// IE uses srcElement, others use target
	targ = e.target ? e.target : e.srcElement;

	if (targ.id != 'meeting') {return};
	// calculate event X, Y coordinates
		/*offsetX = e.touches[0].clientX;
		offsetY = e.touches[0].clientY;*/
		offsetX = e.clientX;
		offsetY = e.clientY;


	// assign default values for top and left properties
	if(!targ.style.left) { targ.style.left='210px'};
	if (!targ.style.top) { targ.style.top='-390px'};

	// calculate integer values for top and left 
	// properties
	coordX = parseInt(targ.style.left);
	coordY = parseInt(targ.style.top);
	drag = true;

	// move element
	document.onmousemove=dragImg;
    return false;
	
}
function dragImg(e) {
	if (!drag) {return};
	if (!e) { var e= window.event};
	// var targ=e.target?e.target:e.srcElement;
	// move div element
	targ.style.left=coordX+e.clientX-offsetX+'px';
	targ.style.top=coordY+e.clientY-offsetY+'px';
	return false;
}
function stopDrag() {
	drag=false;
	$("#newMeeting")[0].style.height="110px";//animates the appearance of the confirmation
}

function no2MeetingMoveConf(){
	$("#newMeeting")[0].style.height="0";
	$("#meeting")[0].style.top="-390px"
	$("#meeting")[0].style.left="210px"
}
function yes2MeetingMoveConf(){
	$("#newMeeting")[0].style.height="0";
	$("#meeting")[0].src="images/icons/meeting-proposed.png";
}

</script>
	<title>Connect</title>
</head>
<body onload="placeFriends()">
<DIV class="container app-panel">
	<div class="row">
		<button onclick="javascript:window.location.href='index.html'">CANCEL</button> <span id="timer" class="timer">30:00</span>
	</div>
	
	<div class="map" id="map">
		<img src="images/map.png">
		<img src="images/icons/meeting.png" id="meeting" alt="meeting" onmousedown="moveMeeting()" onmouseup="stopDrag()" />
	</div>
	
	<div id="newMeeting" class="center">
		<p>Do you want to meet here instead?</p>
		<div class="center">
			<button onclick="no2MeetingMoveConf()">No</button>
			<button onclick="yes2MeetingMoveConf()">Yes</button>
		</div>
		
	</div>
	<script>
		//$("#meeting")[0].addEventListener('touchstart', moveMeeting()); failed attempt to trap touch events; will come back to it.
	</script>
</body>

</html>